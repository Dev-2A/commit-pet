name: ğŸ¾ ì»¤ë°‹í« ì—…ë°ì´íŠ¸

on:
  # ë§¤ì¼ í•œêµ­ì‹œê°„ ì˜¤ì „ 1ì‹œ (UTC 16:00) ìë™ ì‹¤í–‰
  schedule:
    - cron: "0 16 * * *"
  # ìˆ˜ë™ ì‹¤í–‰ ë²„íŠ¼
  workflow_dispatch:

jobs:
  update:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    
    steps:
      - name: ğŸ“¥ ë ˆí¬ì§€í† ë¦¬ ì²´í¬ì•„ì›ƒ
        uses: actions/checkout@v4
      
      - name: ğŸŸ¢ Node.js ì„¤ì¹˜
        uses: actions/setup-node@v4
        with:
          node-version: 20
      
      - name: ğŸ“¦ ì˜ì¡´ì„± ì„¤ì¹˜
        run: npm ci
      
      - name: ğŸ¾ ì»¤ë°‹í« SVG ìƒì„±
        run: npm start
        env:
          GITHUB_TOKEN: ${{ secrets.PET_GITHUB_TOKEN }}
          GITHUB_USERNAME: ${{ github.repository_owner }}
      
      - name: ğŸ“ READMEì— SVG ì‚½ì…
        run: |
          if [ ! -f output/commit-pet.svg ]; then
            echo "âŒ SVG íŒŒì¼ì´ ìƒì„±ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤."
            exit 1
          fi

          # output/commit-pet.svgë¥¼ ë ˆí¬ ë£¨íŠ¸ë¡œ ë³µì‚¬
          cp output/commit-pet.svg commit-pet.svg

          # READMEì— ì´ë¯¸ì§€ íƒœê·¸ê°€ ì—†ìœ¼ë©´ ì¶”ê°€
          if ! grep -q "commit-pet.svg" README.md; then
            sed -i '1a\\n<p align="center"><img src="./commit-pet.svg" alt="commit-pet" /></p>\n' README.md
          fi
      
      - name: ğŸš€ ë³€ê²½ì‚¬í•­ ì»¤ë°‹ & í‘¸ì‹œ
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git add commit-pet.svg README.md
          git diff --staged --quiet || git commit -m "ğŸ¾ ì»¤ë°‹í« ìƒíƒœ ì—…ë°ì´íŠ¸"
          git push
